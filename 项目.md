# DeepSeek AI 浏览器扩展项目实现文档

## 项目概述

DeepSeek AI 是一个浏览器扩展插件，允许用户在浏览网页时直接访问和使用多种 AI 模型服务。该扩展支持多个 AI 提供商，包括 DeepSeek、Silicon Flow、OpenRouter 等，并提供了便捷的用户界面来与这些 AI 模型进行交互。

## 核心功能

1. **多 AI 提供商支持**：
   - DeepSeek
   - Silicon Flow
   - OpenRouter
   - 火山引擎
   - 腾讯云
   - 讯飞星火
   - 百度云
   - 阿里云
   - AIHub Mix

2. **上下文菜单集成**：通过右键菜单快速访问 AI 功能

3. **快捷键支持**：
   - 打开/关闭聊天界面
   - 关闭聊天界面

4. **流式响应处理**：支持 AI 模型的流式输出

5. **自定义 API 设置**：允许用户配置自定义 API URL 和密钥

6. **多语言支持**：默认支持英语，可扩展其他语言

## 具体功能实现

### 1. 聊天功能

#### 1.1 聊天窗口创建
- 通过右键菜单或快捷键触发
- 动态创建浮动窗口，支持拖拽和调整大小
- 使用 CSS 动画实现平滑过渡效果

#### 1.2 消息处理
- 支持 Markdown 格式渲染
- 代码块语法高亮
- 支持复制消息内容
- 流式响应实时显示

#### 1.3 会话管理
- 单页面内保持会话上下文
- 支持清空当前会话
- 支持中断正在生成的响应

### 2. API 集成功能

#### 2.1 DeepSeek API
- 支持模型：deepseek-chat, deepseek-coder 等
- 支持自定义 API 端点
- 支持流式输出

#### 2.2 其他提供商 API
- 每个提供商支持特定模型选择
- 统一的请求格式处理
- 差异化的响应解析

#### 2.3 API 密钥管理
- 安全存储在浏览器本地
- 支持测试 API 连接
- 密钥有效性验证

### 3. 用户界面功能

#### 3.1 主题支持
- 明/暗模式自动切换
- 响应式设计适应不同屏幕尺寸
- 可自定义聊天窗口透明度

#### 3.2 快捷操作
- 一键复制回答内容
- 快捷键控制界面
- 拖拽调整窗口位置和大小

## 页面实现

### 1. 弹出窗口页面 (Popup)

#### 1.1 设置标签页
- **API 密钥配置区域**：
  - 每个提供商的 API 密钥输入框
  - 密钥可见性切换按钮
  - 测试连接按钮

- **模型选择区域**：
  - 下拉菜单选择 AI 提供商
  - 根据提供商动态加载可用模型
  - 默认模型设置

- **自定义 API 配置**：
  - 每个提供商的自定义 API URL 输入
  - 重置为默认值按钮
  - 配置验证提示

#### 1.2 外观标签页
- **语言设置**：
  - 支持语言列表
  - 界面语言切换
  - 响应语言偏好设置

- **主题设置**：
  - 明/暗模式切换
  - 自定义颜色主题
  - 聊天窗口透明度调节

#### 1.3 快捷键标签页
- 显示可用快捷键列表
- 提供快捷键自定义入口
- 快捷键冲突检测

#### 1.4 关于标签页
- 扩展版本信息
- 开发者信息
- 使用说明链接
- 隐私政策链接

### 2. 聊天界面 (Content Script 注入)

#### 2.1 聊天窗口
- **标题栏**：
  - 扩展名称和图标
  - 最小化/最大化按钮
  - 关闭按钮
  - 拖拽手柄

- **聊天区域**：
  - 消息气泡设计
  - 用户/AI 消息区分样式
  - 滚动条自动定位
  - 加载动画

- **输入区域**：
  - 多行文本输入框
  - 发送按钮
  - 停止生成按钮
  - 清空会话按钮

#### 2.2 上下文菜单
- 右键菜单集成
- 选中文本快速查询
- 自定义操作选项

### 3. 说明页面 (Instructions)

#### 3.1 欢迎界面
- 扩展功能概述
- 动画演示主要功能
- 快速开始指南

#### 3.2 设置指导
- API 密钥获取教程
- 分步骤配置说明
- 常见问题解答

#### 3.3 使用技巧
- 快捷键列表
- 高级提示工程技巧
- 最佳实践建议

## 技术架构

### 1. 后台脚本 (Background Script)

后台脚本 `background.js` 作为扩展的核心控制器，负责：

- 处理来自内容脚本的消息
- 管理 API 请求和响应
- 处理上下文菜单和快捷键事件
- 管理用户设置和配置

### 2. 内容脚本 (Content Script)

内容脚本注入到用户访问的网页中，负责：

- 创建和管理聊天界面
- 发送用户输入到后台脚本
- 接收和显示 AI 响应
- 处理用户交互事件

### 3. 弹出窗口 (Popup)

弹出窗口提供用户界面，用于：

- 配置 API 密钥
- 选择 AI 提供商和模型
- 设置语言偏好
- 配置自定义 API URL

### 4. 设置存储

使用 Chrome 存储 API (`chrome.storage.sync`) 保存用户配置：

- API 密钥
- 自定义 API URL
- 语言设置
- 模型选择
- 提供商选择

## 数据流

1. **用户输入流程**：
   - 用户在网页上选择文本并右键点击或使用快捷键
   - 内容脚本创建聊天界面并显示用户输入
   - 内容脚本发送请求到后台脚本
   - 后台脚本处理请求并调用相应的 AI API
   - AI 响应通过后台脚本传回内容脚本
   - 内容脚本更新聊天界面显示响应

2. **设置流程**：
   - 用户通过弹出窗口更改设置
   - 设置保存到 Chrome 存储
   - 后台脚本在需要时从存储中检索设置

## API 集成

扩展通过代理请求方式与各 AI 提供商的 API 进行交互：

1. 内容脚本发送 `proxyRequest` 消息到后台脚本
2. 后台脚本使用 `fetch` API 发送请求到指定的 AI 提供商
3. 对于流式响应，后台脚本使用 `ReadableStream` 处理数据流
4. 响应数据通过消息传递回内容脚本

## 用户界面组件

1. **聊天界面**：
   - 在当前网页上创建的浮动聊天窗口
   - 支持文本输入和显示
   - 可拖动和调整大小

2. **设置界面**：
   - API 密钥配置
   - 模型选择
   - 语言设置
   - 自定义 API URL 配置

3. **上下文菜单**：
   - 在选中文本上右键点击时显示
   - 提供快速访问 AI 功能的入口

## 安全考虑

1. **API 密钥保护**：
   - API 密钥存储在 Chrome 安全存储中
   - 请求直接从浏览器发送，避免通过第三方服务器

2. **请求控制**：
   - 使用 `AbortController` 允许用户取消正在进行的请求
   - 请求控制器映射表确保正确管理多个请求

## 扩展功能

1. **首次安装引导**：
   - 安装后自动打开说明页面
   - 引导用户完成初始设置

2. **问候消息**：
   - 根据一天中的时间提供个性化问候
   - 在没有选择文本时作为默认消息

## 开发和构建

项目使用 Webpack 进行构建，配置包括：

- JavaScript 转译 (Babel)
- CSS 处理
- 资源复制
- 代码压缩和优化

## 使用方法

1. **安装扩展**：
   - 从 Chrome 网上应用店安装
   - 或通过开发者模式加载解压的扩展

2. **配置 API 密钥**：
   - 点击扩展图标打开设置
   - 输入所选 AI 提供商的 API 密钥
   - 可选：配置自定义 API URL

3. **使用扩展**：
   - 选择文本并右键点击选择 "DeepSeek AI"
   - 或使用快捷键打开聊天界面
   - 输入问题并等待 AI 响应

4. **快捷键**：
   - 打开/关闭聊天：`Alt+Shift+D`（可在扩展设置中自定义）
   - 关闭聊天：`Esc`

## 未来改进方向

1. 支持更多 AI 提供商和模型
2. 增强聊天界面功能，如历史记录和会话管理
3. 添加更多自定义选项，如主题和布局
4. 实现高级提示工程功能
5. 添加多模态支持（图像、音频输入/输出）